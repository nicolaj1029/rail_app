MOBILE FLOW CHART
=================

1. **Shadow & Travel Tracking**
   - Device registers with `POST /api/shadow/devices/register`.
   - Shadow tracker collects geofence/gps pings and pushes batches to `/api/shadow/pings`.
   - Backend derives journeys, flags long delays and returns journeys via `/api/shadow/journeys`.

2. **Journey Confirmation**
   - User selects a shadow journey (`Live Assist` or `Dine rejser`).
   - App confirms via `POST /api/shadow/journeys/{id}/confirm` to seed a case linked to the shadow journey.

3. **Case Close Stepper**
   - Step 1 (Rejsens status): confirm departure/arrival, travel status.
   - Step 2 (Hændelse): select delay/cancellation/missed connection, capture actual delay + connecting station.
   - Step 3 (Billet): upload ticket (image/pdf) via `/api/tickets/match` or upload endpoint; autofill PNR, price, currency, through-ticket, PMR/cykel flags from shared web evaluator.
   - Step 4 (Art.18): capture refund/reroute choices, informed-within-100 status, extra costs, downgrade history, align UI with web compensation logic.
   - Step 5 (Art.20 og udlæg): record assistance offers, self-paid expenses (with receipt scanning), extraordinary conditions and wheelchair/escort info; allow OCR-assisted receipt capture.
   - Step 6 (Kompensation): choose refund/reroute option, optionally preview/copy JSON, evaluate via backend `EvaluationService`, submit payload through `JourneysService.submit`.

4. **Integration & Evaluation**
   - All steps send data with art18/art20 flags and ancillary attributes to CakePHP endpoints.
   - Backend evaluation (shared with web) returns identical JSON (fullRefund, alternativeBooking, mealProvided, overnightStay, compensation amount/currency/minutes).
   - Feedback shown via snackbars + evaluation summary panel before final submission.

5. **Ensuring 1:1 parity**
   - Ticket upload/responses reuse same services as the web UI.
   - JSON schemas mirror web (art18/art20 structure, PMR, through-ticket, compensation choice).
   - Receipts + assistance replicate web fields to keep admin data consistent across platforms.

