# GROQ queries for local dataset\n\nThis app appends each upload as a normalized line in `webroot/data/tickets.ndjson`. You can query it locally with `groq-js` or `groq-cli`.\n\n## Dataset format (NDJSON)\n- One JSON object per line with keys like: `_id`, `_type` (ticket), dep/arr stations, dates/times, `train_no`, `ticket_no`, `operator`, `operator_country`, `operator_product`, `extraction_provider`, `extraction_confidence`, and `source` (format, filenames, ocr_chars), `createdAt`.\n\n## Example queries\n\n- Find by ticket/booking reference:\n```groq\n*[_type == "ticket" && ticket_no == "1187-1234567890"]\n```\n\n- Upcoming departures (requires ISO date in `dep_date`):\n```groq\n*[_type == "ticket" && dep_date >= "2025-01-01"]|order(dep_date asc){_id, dep_station, arr_station, dep_date, dep_time, train_no}\n```\n\n- Tickets by operator:\n```groq\n*[_type == "ticket" && operator == "SNCF"]{_id, dep_station, arr_station, dep_date, train_no, ticket_no}\n```\n\n- Low-confidence extractions needing review:\n```groq\n*[_type == "ticket" && extraction_confidence < 0.5]{_id, dep_station, arr_station, dep_date, dep_time, train_no, extraction_provider, extraction_confidence}\n```\n\n## Run locally with groq-js\n\n1) Install dependencies (see `tools/groq/package.json`).\n2) Run the query file pointing to `webroot/data/tickets.ndjson`.\n\n```powershell
node tools/groq/query.mjs "*[_type == \"ticket\" && operator == \"SNCF\"]{_id,dep_station,arr_station,dep_date,train_no}"
```\n\nThis will print JSON to stdout. Adjust the query as needed.\n